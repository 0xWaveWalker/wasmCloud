# Code and documentation generation

You only need to read this section if you want to customize code generation, write a new target language generator, or if you want to know more about how it works.

Code generation is highly data-driven. When a new project is created, the process is  driven by a built-in [codegen.toml](../codegen/templates/codegen.toml). After a project has been created, it uses a smaller codegen.toml (usually in the project's root folder) to update affected source files when the Smithy model is updated.


Each language generator can generate multiple project files, each of which can be built either with a handlebars template or code (an implementation of the [`CodeGen`](../../codegen/src/gen.rs) trait. HTML documentation is created by a code generator for the "html" language, and all of its output files are derived from templates. The Rust code generator uses hbs templates for `Cargo.toml` and various project files, and the code for the smithy model structures and methods is generated by a CodeGen implementation in [codegen_rust.rs](../../codegen/src/codegen_rust.rs).

If you are writing a new lanaguage code generator, you can choose whether you want to use the CodeGen approach or a handlebars template approach. If you choose the CodeGen approach, the easiest way is to copy the [rust implementation](../../codegen/src/codegen_rs) and customize it for your target language.

In the default (built-in) codegen.toml, each handlebars-generated file has a section like this:

```
[[rust.files]]
path = "Cargo.toml"
hbs  = "rust.Cargo.toml"
if_defined = "project_create"
```

where

- `path` is a path to the output file, relative to the language's `output_dir` (which in turn is relative to the `--output-dir` parameter in weld gen).
- `hbs` is the name of the template without the hbs extension.
- The `if_defined` flag checks for the variable definition in the toml parameters (`[html.parameters]`, `[rust.parameters]`, etc), and a variable can be defined (or overridden) on the weld command-line with a `-D key=value` parameter. The weld cli automatically defines `project_create` for any created project, and one of  `create_actor`, `create_interface`, or `create_provider` for the specific project type.

The built-in codegen.toml can be overridden with the `--config` command-line parameter.

## Customizing templates

The default templates are compiled-into the weld binary (and the wasmcloud-weld-codegen library crate), so that you don't need them to be in a local folder to use them.

When you add a template folder, all `.hbs` files in the new folder will be added to the handlebars renderer using a template name derived from the file name without the `.hbs` extension. For example, the file `section.hbs` will be parsed and registered as a template called `section`. Any template with the same name as a built-in) template overrides the built-in template.

## Adding a template folder

New templates can be added on the command-line with the `--template-dir` option (`-T` for short). Alternatively, they can be specified in codegen.toml. Inside the language section of your project's `codegen.toml`, add a template folder with the key `templates`. For example,

```toml
[html]
# add-to or override default templates
templates = "docgen/templates"
```

```toml
[rust]
# add-to or override default templates
templates = "codegen/templates/rust"
```

## Specifying the name of the starting template

HTML documentation generation (guided by the `[html]` language section of the project codegen.toml) uses a template called `namespace` for the primary html page. If you want to use a different template name, for example `mypage`, add `mypage.hbs` to the template directory and use the command line option `-D doc_template=mypage`. If you prefer to set the value in the project's codegen.toml rather than use a command-line option, add `doc_template = "mypage"` to the `[html.parameters]` section.

